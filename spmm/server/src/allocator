// vim:set ft=cpp:

#pragma once

#include <l4/sys/cxx/ipc_epiface>
#include <l4/sys/factory>
#include <l4/re/util/br_manager>
#include <l4/re/util/object_registry>

#include "dataspace"
#include "manager"

extern L4Re::Util::Registry_server<L4Re::Util::Br_manager_hooks> server;

namespace Spmm
{

class Allocator : public Component
{
public:
  virtual ~Allocator() {};

  virtual page_t alloc_imm_p(page_t p) = 0;
  virtual page_t alloc_vol_p(page_t p) = 0;
  virtual void free_imm_p(page_t p) = 0;
  virtual void free_vol_p(page_t p) = 0;
};

class L4ReAllocator : public Allocator,
                      public L4::Epiface_t<L4ReAllocator, L4::Factory>
{
public:
  virtual ~L4ReAllocator() {};

  virtual int op_create(L4::Factory::Rights,
                        L4::Ipc::Cap<void> &res,
                        l4_umword_t type,
                        L4::Ipc::Varg_list<> &&args) = 0;
};

} //Spmm
